<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Proyecto Túneles UCSM</title>
    
    <!-- Librerías -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Saira+Stencil+One&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cat: { DEFAULT: '#FFCD11', dark: '#DAAA00', black: '#101010', panel: '#1E1E1E' }
                    },
                    fontFamily: {
                        stencil: ['"Saira Stencil One"', 'cursive'],
                        sans: ['"Roboto Condensed"', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        body { background-color: #050505; color: #e5e5e5; }
        
        /* --- MOTOR 3D CSS --- */
        .viewport-3d { 
            width: 100%; height: 250px; 
            background: #000; 
            position: relative; 
            overflow: hidden; 
            perspective: 800px;
            border-bottom: 4px solid #FFCD11;
        }

        /* ESCENA TBM (GIRATORIA) */
        .tbm-tunnel {
            width: 100%; height: 100%;
            position: absolute;
            transform-style: preserve-3d;
        }
        .tunnel-wall {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            border: 2px solid #333; border-radius: 50%; box-shadow: 0 0 50px #000;
            opacity: 0; animation: moveTunnel 3s linear infinite;
        }
        .w1 { width: 800px; height: 800px; animation-delay: 0s; }
        .w2 { width: 800px; height: 800px; animation-delay: 1s; }
        .w3 { width: 800px; height: 800px; animation-delay: 2s; }

        @keyframes moveTunnel {
            0% { transform: translate(-50%, -50%) translateZ(-500px); opacity: 0; border-color: #111; }
            20% { opacity: 1; border-color: #444; }
            100% { transform: translate(-50%, -50%) translateZ(200px); opacity: 0; border-color: #666; width: 900px; height: 900px; }
        }

        .cutter-head {
            position: absolute; top: 50%; left: 50%; width: 140px; height: 140px; margin-top: -70px; margin-left: -70px;
            border-radius: 50%; background: radial-gradient(circle, #222 30%, #FFCD11 35%, #997a00 40%, #111 100%);
            border: 4px dashed #333; box-shadow: inset 0 0 20px #000, 0 0 30px rgba(0,0,0,0.8);
            transform: translateZ(-100px); animation: spinHead 4s linear infinite; z-index: 10;
        }
        .disc { position: absolute; width: 18px; height: 18px; background: #888; border-radius: 50%; box-shadow: 2px 2px 5px #000; border: 1px solid #444; }
        @keyframes spinHead { from { transform: translateZ(-100px) rotate(0deg); } to { transform: translateZ(-100px) rotate(360deg); } }

        /* ESCENA PyV (ESTÁTICA) */
        .pyv-scene {
            width: 100%; height: 100%; background: radial-gradient(circle at center, #2a2a2a 0%, #000 80%);
            display: flex; align-items: center; justify-content: center; position: relative;
        }
        .rock-face-irregular {
            width: 200px; height: 160px; background: #1a1a1a;
            clip-path: polygon(20% 0%, 80% 0%, 100% 20%, 100% 100%, 0% 100%, 0% 20%);
            position: relative; box-shadow: inset 0 0 40px #000; border: 1px solid #333;
        }
        .drill-hole { width: 6px; height: 6px; background: #000; border-radius: 50%; position: absolute; box-shadow: 0 0 2px #fff; }
        .jumbo-arm {
            position: absolute; bottom: -20px; right: -20px; width: 150px; height: 20px; background: #FFCD11;
            transform: rotate(-30deg); border: 1px solid #000;
        }

        /* UI */
        input[type=range] { -webkit-appearance: none; background: transparent; width: 100%; cursor: pointer; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 24px; width: 24px; background: #FFCD11; border: 3px solid #000; border-radius: 50%; margin-top: -10px; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #333; }
        
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const Icon = ({ d, c }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={c}><path d={d} /></svg>;
        
        const icons = {
            chart: "M3 3v18h18 M18 17V9 M13 17V5 M8 17v-3",
            gear: "M12 2v20M2 12h20M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10 10 10 0 0 1-10-10 10 10 0 0 1 10-10",
            scale: "M12 3v18m-9-6l9 6 9-6m-18-6l9 6 9-6",
            check: "M20 6L9 17l-5-5",
            info: "M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
        };

        // --- COMPONENTES VISUALES ---
        const TBMView = () => (
            <div className="viewport-3d">
                <div className="tbm-tunnel">
                    <div className="tunnel-wall w1"></div><div className="tunnel-wall w2"></div><div className="tunnel-wall w3"></div>
                    <div className="cutter-head">
                        <div className="disc" style={{top:'20px', left:'60px'}}></div>
                        <div className="disc" style={{bottom:'20px', left:'60px'}}></div>
                        <div className="disc" style={{top:'60px', left:'20px'}}></div>
                        <div className="disc" style={{top:'60px', right:'20px'}}></div>
                        <div className="disc" style={{top:'45px', left:'45px', width:'10px', height:'10px', background:'#000'}}></div>
                    </div>
                </div>
                <div className="absolute top-3 left-3 bg-cat text-black font-bold text-xs px-2 py-1 rounded">VISTA TBM</div>
            </div>
        );

        const PyVView = () => (
            <div className="viewport-3d">
                <div className="pyv-scene">
                    <div className="rock-face-irregular">
                        <div className="drill-hole" style={{top:'30%', left:'30%'}}></div>
                        <div className="drill-hole" style={{top:'30%', right:'30%'}}></div>
                        <div className="drill-hole" style={{top:'50%', left:'50%'}}></div>
                        <div className="drill-hole" style={{bottom:'30%', left:'30%'}}></div>
                        <div className="drill-hole" style={{bottom:'30%', right:'30%'}}></div>
                    </div>
                    <div className="jumbo-arm"></div>
                </div>
                <div className="absolute top-3 left-3 bg-orange-600 text-white font-bold text-xs px-2 py-1 rounded">VISTA JUMBO</div>
            </div>
        );

        // --- SIMULADOR ---
        const Simulator = () => {
            const [len, setLen] = useState(6);
            const [pyvInv, setPyvInv] = useState(2); 
            const [pyvVar, setPyvVar] = useState(5); 
            const [tbmInv, setTbmInv] = useState(15); 
            const [tbmVar, setTbmVar] = useState(2.5); 

            const totalPyV = pyvInv + len * pyvVar;
            const totalTBM = tbmInv + len * tbmVar;
            const winner = totalTBM < totalPyV ? 'TBM' : 'PyV';
            const savings = Math.abs(totalTBM - totalPyV).toFixed(1);

            return (
                <div className="animate-fade-in space-y-4">
                    <div className="grid md:grid-cols-2 gap-4">
                        <div className="bg-cat-panel rounded-lg overflow-hidden shadow-lg border border-gray-800">
                            {winner === 'TBM' ? <TBMView /> : <PyVView />}
                            <div className="p-4 bg-black/50">
                                <div className="flex justify-between items-center text-gray-400 text-sm mb-1">
                                    <span>Longitud Total</span><span className="text-white font-mono text-xl">{len} km</span>
                                </div>
                                <input type="range" min="1" max="20" step="0.5" value={len} onChange={e=>setLen(+e.target.value)} />
                            </div>
                        </div>
                        <div className="space-y-4">
                            <div className={`p-4 rounded-lg border-l-4 bg-[#1a1a1a] ${winner==='PyV' ? 'border-orange-500 shadow-lg' : 'border-gray-600 opacity-60'}`}>
                                <div className="flex justify-between mb-3 border-b border-gray-700 pb-2">
                                    <h3 className="font-bold text-orange-500">CONVENCIONAL (PyV)</h3><span className="font-mono text-xl text-white">${totalPyV.toFixed(1)}M</span>
                                </div>
                                <div className="space-y-3">
                                    <div><div className="text-xs text-gray-400 font-bold mb-1">INVERSIÓN: <span className="text-orange-400">${pyvInv}M</span></div><input type="range" min="0.5" max="5" step="0.5" value={pyvInv} onChange={e=>setPyvInv(+e.target.value)} /></div>
                                    <div><div className="text-xs text-gray-400 font-bold mb-1">COSTO/M: <span className="text-orange-400">${pyvVar}k</span></div><input type="range" min="3" max="8" step="0.5" value={pyvVar} onChange={e=>setPyvVar(+e.target.value)} /></div>
                                </div>
                            </div>
                            <div className={`p-4 rounded-lg border-l-4 bg-[#1a1a1a] ${winner==='TBM' ? 'border-cat shadow-lg' : 'border-gray-600 opacity-60'}`}>
                                <div className="flex justify-between mb-3 border-b border-gray-700 pb-2">
                                    <h3 className="font-bold text-cat">MECANIZADO (TBM)</h3><span className="font-mono text-xl text-white">${totalTBM.toFixed(1)}M</span>
                                </div>
                                <div className="space-y-3">
                                    <div><div className="text-xs text-gray-400 font-bold mb-1">INVERSIÓN: <span className="text-cat">${tbmInv}M</span></div><input type="range" min="10" max="30" step="1" value={tbmInv} onChange={e=>setTbmInv(+e.target.value)} /></div>
                                    <div><div className="text-xs text-gray-400 font-bold mb-1">COSTO/M: <span className="text-cat">${tbmVar}k</span></div><input type="range" min="1" max="4" step="0.5" value={tbmVar} onChange={e=>setTbmVar(+e.target.value)} /></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div className="bg-cat text-black p-4 rounded font-bold text-center uppercase tracking-widest shadow-lg">
                        MEJOR OPCIÓN: {winner === 'TBM' ? 'TUNELADORA' : 'VOLADURA'} (AHORRO ${savings}M)
                    </div>
                </div>
            );
        };

        // --- ASISTENTE DE DECISIÓN (MEJORADO) ---
        const Wizard = () => {
            const [step, setStep] = useState(0);
            const [score, setScore] = useState(0);
            const [reasons, setReasons] = useState([]); // Almacena el "por qué"

            // Cuestionario ampliado a 6 preguntas
            const qs = [
                { t: "Longitud", q: "1. LONGITUD DEL TÚNEL", opts: [{l:"< 3 KM (Corto)", s:-5, r:"La corta longitud (<3km) hace inviable amortizar el alto costo inicial de la TBM."}, {l:"3 - 7 KM (Medio)", s:0, r:"Longitud intermedia; la decisión depende de otros factores geológicos."}, {l:"> 7 KM (Largo)", s:5, r:"La gran longitud (>7km) permite diluir la inversión inicial de la TBM y aprovechar su velocidad."}] },
                { t: "Roca", q: "2. CALIDAD DE LA ROCA", opts: [{l:"ROCA DURA / SANA", s:3, r:"La roca dura es ideal para TBM, ofreciendo avances rápidos sin mucho soporte inmediato."}, {l:"SUELO BLANDO / MIXTO", s:5, r:"En suelo blando, la TBM (Escudo/EPB) es superior por seguridad y control de subsidencia."}, {l:"FALLAS / INESTABLE", s:-3, r:"La geología inestable favorece PyV por su flexibilidad para cambiar el sostenimiento metro a metro."}] },
                { t: "Plazo", q: "3. PLAZO DE INICIO", opts: [{l:"INMEDIATO (< 2 meses)", s:-5, r:"La urgencia de inicio descarta la TBM, que requiere meses de fabricación y montaje."}, {l:"PLANIFICADO (> 6 meses)", s:2, r:"Hay tiempo suficiente para la logística compleja de importación y montaje de una TBM."}] },
                { t: "Vida Útil", q: "4. VIDA ÚTIL PROYECTO", opts: [{l:"TEMPORAL (Acceso)", s:-2, r:"Para obras temporales, la inversión en TBM no se justifica; PyV es más económico."}, {l:"LARGA (Infraestructura)", s:3, r:"La calidad final y durabilidad del revestimiento de dovelas TBM favorece obras de larga vida."}] },
                { t: "Agua", q: "5. PRESENCIA DE AGUA", opts: [{l:"BAJA / SECO", s:0, r:"Sin problemas de agua, ambos métodos son viables operativamente."}, {l:"ALTA PRESIÓN / ACUÍFERO", s:5, r:"La TBM EPB puede trabajar bajo presión de agua, sellando el túnel inmediatamente."}] },
                { t: "Espacio", q: "6. ÁREA DISPONIBLE", opts: [{l:"LIMITADA (Portal Pequeño)", s:-3, r:"El espacio reducido en el portal impide el montaje del tren de la TBM; favorece PyV."}, {l:"AMPLIA (Patio TBM)", s:2, r:"El área amplia permite el montaje y logística de dovelas necesarios para la TBM."}] }
            ];

            const vote = (opt) => {
                const newScore = score + opt.s;
                const newReasons = [...reasons, { topic: qs[step].t, text: opt.r, type: opt.s > 0 ? 'TBM' : opt.s < 0 ? 'PyV' : 'Neutral' }];
                setScore(newScore);
                setReasons(newReasons);
                setStep(step + 1);
            };

            if(step === qs.length) {
                const isTBM = score > 0;
                return (
                    <div className="animate-fade-in flex flex-col h-full">
                        <div className="bg-cat-panel rounded border border-gray-800 p-6 text-center mb-6">
                            <h2 className="text-3xl font-stencil text-white mb-2">RECOMENDACIÓN</h2>
                            <div className={`text-5xl font-black mb-2 ${isTBM ? 'text-cat' : 'text-orange-500'}`}>
                                {isTBM ? 'USAR TBM' : 'USAR PyV'}
                            </div>
                            <p className="text-gray-400 text-xs font-mono mb-0">PUNTAJE NETO: {score}</p>
                        </div>

                        <div className="flex-1 overflow-y-auto pr-2">
                            <h3 className="text-cat font-bold text-sm uppercase border-b border-gray-800 pb-2 mb-4">RAZONAMIENTO DETALLADO</h3>
                            <div className="space-y-3">
                                {reasons.map((r, i) => (
                                    <div key={i} className={`p-3 rounded text-sm border-l-4 ${r.type === 'TBM' ? 'bg-cat/10 border-cat' : r.type === 'PyV' ? 'bg-orange-900/20 border-orange-500' : 'bg-gray-800 border-gray-600'}`}>
                                        <div className="flex justify-between mb-1">
                                            <span className="font-bold text-white uppercase text-xs">{r.topic}</span>
                                            <span className="text-[10px] opacity-50 font-mono">{r.type === 'Neutral' ? 'NEUTRO' : `FAVORECE ${r.type}`}</span>
                                        </div>
                                        <p className="text-gray-400 text-xs leading-relaxed">{r.text}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                        
                        <button onClick={()=>{setStep(0);setScore(0);setReasons([])}} className="mt-6 bg-cat text-black font-bold py-3 w-full rounded uppercase tracking-widest hover:bg-white transition-colors">
                            REINICIAR ANÁLISIS
                        </button>
                    </div>
                )
            }

            return (
                <div className="animate-fade-in p-6 h-[550px] flex flex-col justify-center bg-cat-panel rounded border border-gray-800">
                    <div className="text-cat text-xs font-mono mb-2">PASO {step+1} / {qs.length}</div>
                    <h2 className="text-3xl font-stencil text-white mb-8">{qs[step].q}</h2>
                    <div className="space-y-4">
                        {qs[step].opts.map((o,i) => (
                            <button key={i} onClick={()=>vote(o)} className="w-full py-4 px-6 bg-black border border-gray-700 text-white font-bold text-lg hover:border-cat hover:text-cat transition-all rounded-sm uppercase text-left flex justify-between items-center group">
                                <span>{o.l}</span>
                                <Icon d={icons.check} c="w-5 h-5 opacity-0 group-hover:opacity-100 transition-opacity text-cat" />
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // --- COMPARATIVA (EXPANDIDA) ---
        const Comparison = () => (
            <div className="animate-fade-in space-y-4 pb-24">
                {[
                    { t: "INVERSIÓN INICIAL (CAPEX)", v1: "MUY ALTA ($15M+)", v2: "BAJA ($2M+)", w: 2 },
                    { t: "VELOCIDAD DE AVANCE", v1: "RÁPIDA (15-30 m/día)", v2: "LENTA (4-8 m/día)", w: 1 },
                    { t: "FLEXIBILIDAD SECCIÓN", v1: "NULA (Circular)", v2: "ALTA (Herradura)", w: 2 },
                    { t: "SEGURIDAD PERSONAL", v1: "MÁXIMA (Bajo Escudo)", v2: "MEDIA (Exposición)", w: 1 },
                    { t: "VIDA ÚTIL EQUIPO", v1: "UN PROYECTO", v2: "REUTILIZABLE", w: 2 },
                    { t: "TIEMPO MOVILIZACIÓN", v1: "LARGO (3-6 meses)", v2: "CORTO (Semanas)", w: 2 },
                    { t: "VENTILACIÓN", v1: "EFICIENTE (Ducto)", v2: "COMPLEJA (Gases)", w: 1 },
                    { t: "SOSTENIMIENTO", v1: "DOVELAS (Final)", v2: "SHOTCRETE (Temp)", w: 1 },
                    { t: "CONSUMO ENERGÉTICO", v1: "ALTO (Eléctrico)", v2: "MEDIO (Diesel)", w: 1 },
                    { t: "PERSONAL REQUERIDO", v1: "ESPECIALIZADO", v2: "OPERATIVO", w: 2 }
                ].map((item, i) => (
                    <div key={i} className="bg-cat-panel border border-gray-800 rounded overflow-hidden">
                        <div className="bg-black p-2 text-center text-xs font-bold text-cat uppercase tracking-widest border-b border-gray-800">
                            {item.t}
                        </div>
                        <div className="grid grid-cols-2 divide-x divide-gray-800">
                            <div className={`p-4 text-center ${item.w === 1 ? 'bg-cat/5' : ''}`}>
                                <div className="text-[10px] text-gray-500 mb-1">TBM</div>
                                <div className={`text-sm font-bold ${item.w === 1 ? 'text-cat' : 'text-gray-400'}`}>{item.v1}</div>
                            </div>
                            <div className={`p-4 text-center ${item.w === 2 ? 'bg-orange-900/10' : ''}`}>
                                <div className="text-[10px] text-gray-500 mb-1">PyV</div>
                                <div className={`text-sm font-bold ${item.w === 2 ? 'text-orange-500' : 'text-gray-400'}`}>{item.v2}</div>
                            </div>
                        </div>
                    </div>
                ))}
            </div>
        );

        // --- APP ---
        const App = () => {
            const [tab, setTab] = useState('sim');

            return (
                <div className="min-h-screen font-sans text-gray-200 bg-black pb-20">
                    <header className="bg-cat-panel border-b-4 border-cat p-4 sticky top-0 z-50 shadow-lg mb-6">
                        <div className="flex justify-between items-end">
                            <div>
                                <h1 className="text-2xl font-stencil text-white leading-none tracking-tighter">
                                    <span className="text-cat">UCSM</span> MINING
                                </h1>
                                <div className="text-[10px] text-gray-500 font-mono tracking-widest mt-1">INGENIERÍA DE MINAS</div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-4xl mx-auto px-4">
                        {tab === 'sim' && <Simulator />}
                        {tab === 'wiz' && <Wizard />}
                        {tab === 'comp' && <Comparison />}
                        
                        <div className="mt-12 mb-8 pt-8 border-t border-gray-800 text-center">
                            <div className="text-cat font-bold text-xs uppercase mb-2">PROYECTO ACADÉMICO</div>
                            <div className="text-gray-500 text-[10px] font-mono tracking-widest">
                                CREADO POR: GARCÍA • FLORES • PINTO
                            </div>
                            <div className="text-gray-600 text-[10px] mt-1 uppercase">Universidad Católica de Santa María</div>
                        </div>
                    </main>

                    <nav className="fixed bottom-0 w-full bg-cat-panel border-t border-gray-800 pb-safe z-50">
                        <div className="flex justify-around h-16 max-w-4xl mx-auto">
                            <button onClick={()=>setTab('sim')} className={`flex-1 flex flex-col items-center justify-center ${tab==='sim' ? 'text-cat border-t-2 border-cat bg-white/5' : 'text-gray-500'}`}>
                                <Icon d={icons.chart} c="w-6 h-6 mb-1" /><span className="text-[10px] font-bold uppercase">Simulador</span>
                            </button>
                            <button onClick={()=>setTab('wiz')} className={`flex-1 flex flex-col items-center justify-center ${tab==='wiz' ? 'text-cat border-t-2 border-cat bg-white/5' : 'text-gray-500'}`}>
                                <Icon d={icons.gear} c="w-6 h-6 mb-1" /><span className="text-[10px] font-bold uppercase">Asistente</span>
                            </button>
                            <button onClick={()=>setTab('comp')} className={`flex-1 flex flex-col items-center justify-center ${tab==='comp' ? 'text-cat border-t-2 border-cat bg-white/5' : 'text-gray-500'}`}>
                                <Icon d={icons.scale} c="w-6 h-6 mb-1" /><span className="text-[10px] font-bold uppercase">Comparar</span>
                            </button>
                        </div>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
