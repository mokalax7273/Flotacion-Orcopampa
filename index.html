<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyecto Túneles - UCSM</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; }
        .animate-enter { animation: enter 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes enter { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Sliders personalizados */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; margin-top: -7px; background: white; border: 2px solid #4f46e5; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #e2e8f0; border-radius: 2px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- SISTEMA DE ICONOS (SVG) ---
        const Icon = ({ path, className, fill = "none" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const icons = {
            brain: <path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z" />,
            chart: <path d="M3 3v18h18 M18 17V9 M13 17V5 M8 17v-3" />,
            book: (
                <React.Fragment>
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" />
                </React.Fragment>
            ),
            scale: <path d="M12 3v18m-9-6l9 6 9-6m-18-6l9 6 9-6" />,
            check: <polyline points="20 6 9 17 4 12" />,
            x: (
                <React.Fragment>
                    <line x1="18" y1="6" x2="6" y2="18" />
                    <line x1="6" y1="6" x2="18" y2="18" />
                </React.Fragment>
            ),
            alert: <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z M12 9v4 M12 17h.01" />,
            tbm: <circle cx="12" cy="12" r="9" />,
            drill: <path d="M6 9l6 6 6-6" />,
            water: <path d="M12 2.69l5.74 5.74a8.43 8.43 0 0 1 0 11.92 8.43 8.43 0 0 1-11.48 0 8.43 8.43 0 0 1 0-11.92L12 2.69z" />
        };

        // --- 1. ASISTENTE DE DECISIÓN ---
        const DecisionWizard = () => {
            const [step, setStep] = useState(0);
            const [scores, setScores] = useState({ tbm: 0, pyv: 0 });
            
            const questions = [
                {
                    title: "Longitud del Túnel",
                    options: [
                        { label: "< 3 km", tbm: 0, pyv: 5, risk: "PyV estándar" },
                        { label: "3 - 7 km", tbm: 3, pyv: 3, risk: "Zona Gris" },
                        { label: "> 7 km", tbm: 5, pyv: 1, risk: "TBM recomendada" }
                    ]
                },
                {
                    title: "Geología del Macizo",
                    options: [
                        { label: "Roca Dura Homogénea", tbm: 5, pyv: 3, risk: "Ideal TBM" },
                        { label: "Fallas Frecuentes", tbm: 1, pyv: 5, risk: "Riesgo TBM" },
                        { label: "Suelo Blando / Acuífero", tbm: 5, pyv: 1, risk: "EPB Obligatorio" }
                    ]
                },
                {
                    title: "Forma de Sección",
                    options: [
                        { label: "Circular", tbm: 5, pyv: 2, risk: "Óptimo TBM" },
                        { label: "Herradura / Variable", tbm: 0, pyv: 5, risk: "Solo PyV" }
                    ]
                },
                {
                    title: "Urgencia de Inicio",
                    options: [
                        { label: "Inmediata", tbm: 0, pyv: 5, risk: "PyV Inmediato" },
                        { label: "Planificada (>6 meses)", tbm: 4, pyv: 4, risk: "Ambos" }
                    ]
                }
            ];

            const handleAnswer = (opt) => {
                setScores(prev => ({ tbm: prev.tbm + opt.tbm, pyv: prev.pyv + opt.pyv }));
                setStep(step + 1);
            };

            const reset = () => { setStep(0); setScores({ tbm: 0, pyv: 0 }); };

            if (step === questions.length) {
                const winner = scores.tbm > scores.pyv ? "Tuneladora (TBM)" : "Perforación y Voladura";
                return (
                    <div className="animate-enter bg-white rounded-2xl shadow-xl border border-slate-200 p-8 text-center max-w-2xl mx-auto mt-8">
                        <h2 className="text-2xl font-bold text-slate-800 mb-6">Resultado del Análisis</h2>
                        <div className="bg-slate-900 text-white rounded-xl p-8 mb-6 relative overflow-hidden">
                            <div className="relative z-10">
                                <div className="text-sm font-bold uppercase tracking-widest opacity-70 mb-2">Método Recomendado</div>
                                <div className="text-3xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400 mb-4">
                                    {winner}
                                </div>
                                <div className="flex justify-center gap-6 text-sm font-medium">
                                    <span className={scores.tbm > scores.pyv ? "text-emerald-400" : "text-slate-500"}>TBM: {scores.tbm} pts</span>
                                    <span className={scores.pyv >= scores.tbm ? "text-emerald-400" : "text-slate-500"}>PyV: {scores.pyv} pts</span>
                                </div>
                            </div>
                            <div className="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-indigo-600 rounded-full opacity-20 blur-3xl"></div>
                        </div>
                        <button onClick={reset} className="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg transition-colors">Reiniciar</button>
                    </div>
                );
            }

            const q = questions[step];
            return (
                <div className="animate-enter max-w-xl mx-auto mt-8">
                    <div className="text-xs font-bold text-slate-400 uppercase mb-4 text-center">Pregunta {step + 1} de {questions.length}</div>
                    <div className="bg-white rounded-2xl shadow-lg border border-slate-200 p-8">
                        <h3 className="text-xl font-bold text-slate-800 mb-6 text-center">{q.title}</h3>
                        <div className="space-y-3">
                            {q.options.map((opt, idx) => (
                                <button key={idx} onClick={() => handleAnswer(opt)} className="w-full text-left p-4 rounded-xl border border-slate-200 hover:border-indigo-600 hover:bg-indigo-50 transition-all font-medium text-slate-700 hover:text-indigo-800">
                                    {opt.label}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // --- 2. SIMULADOR ECONÓMICO ---
        const Simulator = () => {
            const [len, setLen] = useState(6);
            const [pyvFixed, setPyvFixed] = useState(2); 
            const [pyvVar, setPyvVar] = useState(5);     
            const [tbmFixed, setTbmFixed] = useState(15); 
            const [tbmVar, setTbmVar] = useState(2.5);    

            const breakEvenKm = (tbmFixed - pyvFixed) / (pyvVar - tbmVar);
            const isValidBreakEven = breakEvenKm > 0 && isFinite(breakEvenKm);
            const costPyV = pyvFixed + len * pyvVar; 
            const costTBM = tbmFixed + len * tbmVar;
            
            const W=600, H=280, PAD=40;
            const maxKm = 15;
            const maxCost = Math.max(pyvFixed + maxKm*pyvVar, tbmFixed + maxKm*tbmVar) * 1.1;
            const x = v => PAD + (v/maxKm)*(W-PAD*2);
            const y = v => H - PAD - (v/maxCost)*(H-PAD*2);

            return (
                <div className="animate-enter grid lg:grid-cols-12 gap-6 h-full">
                    <div className="lg:col-span-4 bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col justify-between">
                        <div className="space-y-6">
                            <div>
                                <label className="text-xs font-bold text-slate-400 uppercase">Longitud (km)</label>
                                <div className="text-4xl font-extrabold text-slate-800 mb-2">{len} km</div>
                                <input type="range" min="1" max="15" step="0.5" value={len} onChange={e=>setLen(+e.target.value)} className="w-full" />
                            </div>
                            <div className="p-4 bg-orange-50 rounded-xl border border-orange-100 space-y-3">
                                <h4 className="font-bold text-orange-800 text-sm flex items-center gap-2"><div className="w-3 h-3 rounded-full bg-orange-500"></div> PyV (Voladura)</h4>
                                <div className="flex justify-between text-xs text-orange-700"><span>Inv: ${pyvFixed}M</span><span>Var: ${pyvVar}k/m</span></div>
                                <input type="range" min="0.5" max="5" step="0.5" value={pyvFixed} onChange={e=>setPyvFixed(+e.target.value)} className="w-full accent-orange-500" />
                                <input type="range" min="3" max="8" step="0.5" value={pyvVar} onChange={e=>setPyvVar(+e.target.value)} className="w-full accent-orange-500" />
                            </div>
                            <div className="p-4 bg-blue-50 rounded-xl border border-blue-100 space-y-3">
                                <h4 className="font-bold text-blue-800 text-sm flex items-center gap-2"><div className="w-3 h-3 rounded-full bg-blue-500"></div> TBM (Tuneladora)</h4>
                                <div className="flex justify-between text-xs text-blue-700"><span>Inv: ${tbmFixed}M</span><span>Var: ${tbmVar}k/m</span></div>
                                <input type="range" min="10" max="30" step="1" value={tbmFixed} onChange={e=>setTbmFixed(+e.target.value)} className="w-full accent-blue-500" />
                                <input type="range" min="1" max="4" step="0.5" value={tbmVar} onChange={e=>setTbmVar(+e.target.value)} className="w-full accent-blue-500" />
                            </div>
                        </div>
                    </div>

                    <div className="lg:col-span-8 bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col">
                        <div className="flex-1 relative min-h-[300px]">
                            <svg viewBox={`0 0 ${W} ${H}`} className="w-full h-full">
                                <line x1={PAD} y1={H-PAD} x2={W-PAD} y2={H-PAD} stroke="#cbd5e1" strokeWidth="2" />
                                <line x1={PAD} y1={PAD} x2={PAD} y2={H-PAD} stroke="#cbd5e1" strokeWidth="2" />
                                <text x={W-PAD} y={H-15} textAnchor="end" fontSize="11" fill="#94a3b8">km</text>
                                <text x={PAD+10} y={30} fontSize="11" fill="#94a3b8">$</text>
                                <path d={`M ${x(0)} ${y(pyvFixed)} L ${x(maxKm)} ${y(pyvFixed+maxKm*pyvVar)}`} stroke="#f97316" strokeWidth="3" />
                                <path d={`M ${x(0)} ${y(tbmFixed)} L ${x(maxKm)} ${y(tbmFixed+maxKm*tbmVar)}`} stroke="#3b82f6" strokeWidth="3" />
                                {isValidBreakEven && breakEvenKm < maxKm && (
                                    <React.Fragment>
                                        <line x1={x(breakEvenKm)} y1={PAD} x2={x(breakEvenKm)} y2={H-PAD} stroke="#94a3b8" strokeWidth="1" strokeDasharray="4" />
                                        <circle cx={x(breakEvenKm)} cy={y(tbmFixed+breakEvenKm*tbmVar)} r="6" fill="#10b981" stroke="white" strokeWidth="2" />
                                        <text x={x(breakEvenKm)+10} y={y(tbmFixed+breakEvenKm*tbmVar)-10} fontSize="12" fill="#10b981" fontWeight="bold">Equilibrio: {breakEvenKm.toFixed(1)} km</text>
                                    </React.Fragment>
                                )}
                                <line x1={x(len)} y1={PAD} x2={x(len)} y2={H-PAD} stroke="#64748b" strokeWidth="2" />
                                <circle cx={x(len)} cy={y(costPyV)} r="5" fill="#f97316" stroke="white" strokeWidth="2" />
                                <circle cx={x(len)} cy={y(costTBM)} r="5" fill="#3b82f6" stroke="white" strokeWidth="2" />
                            </svg>
                        </div>
                        <div className="mt-4 flex justify-between bg-slate-50 p-4 rounded-xl border border-slate-100">
                            <div className="flex gap-6">
                                <div><div className="text-xs text-orange-600 font-bold">Total PyV</div><div className="text-xl font-bold">${costPyV.toFixed(1)} M</div></div>
                                <div><div className="text-xs text-blue-600 font-bold">Total TBM</div><div className="text-xl font-bold">${costTBM.toFixed(1)} M</div></div>
                            </div>
                            <div className={`px-4 py-2 rounded-lg text-white font-bold text-sm flex items-center ${costTBM < costPyV ? 'bg-blue-600' : 'bg-orange-600'}`}>Mejor: {costTBM < costPyV ? 'TBM' : 'PyV'}</div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 3. COMPARATIVA Y ESCENARIOS ---
        const ComparisonTable = () => {
            const data = [
                { c: "Inversión (CAPEX)", tbm: "Muy Alta ($$$)", pyv: "Baja ($)", w: "pyv" },
                { c: "Velocidad Avance", tbm: "Rápida (20m+/día)", pyv: "Lenta (5m/día)", w: "tbm" },
                { c: "Flexibilidad", tbm: "Baja (Circular)", pyv: "Alta (Variable)", w: "pyv" },
                { c: "Seguridad", tbm: "Alta (Escudo)", pyv: "Media (Expuesto)", w: "tbm" },
            ];
            const scenarios = [
                { t: "Acceso Mina (<3km)", w: "PyV", d: "La TBM no amortiza su costo de movilización.", c: "orange" },
                { t: "Túnel Largo (>8km)", w: "TBM", d: "La velocidad de TBM reduce costos drásticamente.", c: "blue" },
                { t: "Cruce Acuífero", w: "TBM EPB", d: "Necesario presurizar frente para evitar colapso.", c: "blue" },
            ];
            return (
                <div className="animate-enter grid lg:grid-cols-2 gap-8">
                    <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                        <table className="w-full text-left text-sm">
                            <thead className="bg-slate-50 border-b border-slate-200 font-bold text-slate-500 uppercase"><tr><th className="p-4">Criterio</th><th className="p-4 text-blue-700">TBM</th><th className="p-4 text-orange-700">PyV</th></tr></thead>
                            <tbody className="divide-y divide-slate-100">{data.map((r,i)=><tr key={i}><td className="p-4 font-semibold">{r.c}</td><td className={`p-4 ${r.w==='tbm'?'text-green-600 font-bold':''}`}>{r.tbm}</td><td className={`p-4 ${r.w==='pyv'?'text-green-600 font-bold':''}`}>{r.pyv}</td></tr>)}</tbody>
                        </table>
                    </div>
                    <div className="space-y-4">
                        {scenarios.map((sc,i)=>(
                            <div key={i} className={`bg-white p-5 rounded-xl border-l-4 shadow-sm ${sc.c==='blue'?'border-blue-500':'border-orange-500'}`}>
                                <h3 className="font-bold text-lg text-slate-800">{sc.t}</h3>
                                <p className="text-sm text-slate-600 my-2">{sc.d}</p>
                                <span className={`text-xs font-bold uppercase ${sc.c==='blue'?'text-blue-600':'text-orange-600'}`}>Ganador: {sc.w}</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        const App = () => {
            const [tab, setTab] = useState('sim');
            const menu = [
                { id: 'sim', label: 'Simulador', icon: icons.chart },
                { id: 'wiz', label: 'Asistente', icon: icons.brain },
                { id: 'comp', label: 'Comparativa', icon: icons.scale }
            ];

            return (
                <div className="min-h-screen pb-20 bg-slate-50">
                    {/* Header Modificado */}
                    <div className="bg-slate-900 text-white pt-10 pb-24 px-4 shadow-xl">
                        <div className="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
                            <div>
                                <h1 className="text-3xl md:text-4xl font-extrabold tracking-tight mb-2">
                                    Evaluación y Optimización de Túneles
                                </h1>
                                <p className="text-indigo-200 font-medium text-lg">
                                    Hecho por estudiantes de Ingeniería de Minas de la Universidad Católica de Santa María
                                </p>
                            </div>
                            <div className="hidden md:block text-right opacity-50">
                                <div className="text-xs font-bold uppercase">Código del Proyecto</div>
                                <div className="font-mono">UCSM-MIN-2024</div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-6xl mx-auto px-4 -mt-16 relative z-10">
                        <div className="bg-white p-2 rounded-xl shadow-lg border border-slate-200 flex flex-wrap gap-2 mb-8">
                            {menu.map(item => (
                                <button key={item.id} onClick={() => setTab(item.id)} className={`flex-1 flex items-center justify-center gap-2 py-3 px-4 rounded-lg font-bold text-sm transition-all ${tab === item.id ? 'bg-indigo-600 text-white shadow-md' : 'text-slate-500 hover:bg-slate-50'}`}>
                                    <Icon path={item.icon} className="w-5 h-5" />
                                    <span>{item.label}</span>
                                </button>
                            ))}
                        </div>
                        <div className="min-h-[500px]">
                            {tab === 'sim' && <Simulator />}
                            {tab === 'wiz' && <DecisionWizard />}
                            {tab === 'comp' && <ComparisonTable />}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
