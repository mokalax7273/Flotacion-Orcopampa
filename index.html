<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herramienta de evaluacion técnica de tuneles</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .slide-in { animation: slideIn 0.4s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #3b82f6; margin-top: -6px; cursor: pointer; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #e2e8f0; border-radius: 2px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // --- ICONOS SVG NATIVOS ---
        const Icon = ({ path, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );
        const icons = {
            chart: <path d="M18 20V10M12 20V4M6 20v-6" />,
            brain: <path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z" />,
            droplet: <path d="M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z" />,
            check: <polyline points="20 6 9 17 4 12" />,
            alert: <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z M12 9v4 M12 17h.01" />,
            settings: <circle cx="12" cy="12" r="3" />,
            tool: <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" />
        };

        // --- COMPONENTE: GRÁFICO DE COSTOS INTERACTIVO (SVG) ---
        const CostChart = ({ length, fixedPyV, varPyV, fixedTBM, varTBM }) => {
            const maxLen = 15; // km
            const maxCost = Math.max(
                fixedPyV + (maxLen * varPyV), 
                fixedTBM + (maxLen * varTBM)
            );
            
            // Escalas
            const w = 500, h = 250;
            const pad = 30;
            const xScale = (km) => pad + (km / maxLen) * (w - pad * 2);
            const yScale = (cost) => h - pad - (cost / maxCost) * (h - pad * 2);

            // Puntos de las líneas
            const p1_start = `${xScale(0)},${yScale(fixedPyV)}`;
            const p1_end = `${xScale(maxLen)},${yScale(fixedPyV + maxLen * varPyV)}`;
            
            const p2_start = `${xScale(0)},${yScale(fixedTBM)}`;
            const p2_end = `${xScale(maxLen)},${yScale(fixedTBM + maxLen * varTBM)}`;

            // Punto actual del usuario
            const currentX = xScale(length);
            const currentCostPyV = fixedPyV + length * varPyV;
            const currentCostTBM = fixedTBM + length * varTBM;

            return (
                <div className="relative w-full overflow-hidden bg-white rounded-lg shadow-inner border border-slate-200">
                    <svg viewBox={`0 0 ${w} ${h}`} className="w-full h-full">
                        {/* Ejes */}
                        <line x1={pad} y1={h-pad} x2={w-pad} y2={h-pad} stroke="#cbd5e1" strokeWidth="2" />
                        <line x1={pad} y1={pad} x2={pad} y2={h-pad} stroke="#cbd5e1" strokeWidth="2" />
                        
                        {/* Texto Ejes */}
                        <text x={w-pad} y={h-10} fontSize="10" fill="#64748b" textAnchor="end">Distancia (15km)</text>
                        <text x={pad+10} y={20} fontSize="10" fill="#64748b">Costo ($)</text>

                        {/* Línea PyV (Naranja) */}
                        <line x1={p1_start.split(',')[0]} y1={p1_start.split(',')[1]} x2={p1_end.split(',')[0]} y1={p1_end.split(',')[1]} stroke="#f97316" strokeWidth="3" />
                        <text x={xScale(maxLen)+5} y={yScale(fixedPyV + maxLen * varPyV)} fontSize="10" fill="#f97316">PyV</text>

                        {/* Línea TBM (Azul) */}
                        <line x1={p2_start.split(',')[0]} y1={p2_start.split(',')[1]} x2={p2_end.split(',')[0]} y1={p2_end.split(',')[1]} stroke="#3b82f6" strokeWidth="3" />
                        <text x={xScale(maxLen)+5} y={yScale(fixedTBM + maxLen * varTBM)} fontSize="10" fill="#3b82f6">TBM</text>

                        {/* Indicador de posición actual */}
                        <line x1={currentX} y1={pad} x2={currentX} y2={h-pad} stroke="#94a3b8" strokeWidth="1" strokeDasharray="4" />
                        
                        <circle cx={currentX} cy={yScale(currentCostPyV)} r="4" fill="#f97316" stroke="white" strokeWidth="2"/>
                        <circle cx={currentX} cy={yScale(currentCostTBM)} r="4" fill="#3b82f6" stroke="white" strokeWidth="2"/>
                    </svg>
                    <div className="absolute top-2 right-4 bg-white/90 p-2 rounded text-xs shadow border">
                        <div className="flex items-center gap-2"><div className="w-2 h-2 rounded-full bg-orange-500"></div> PyV: Pendiente Alta (Costo Var.)</div>
                        <div className="flex items-center gap-2"><div className="w-2 h-2 rounded-full bg-blue-500"></div> TBM: Pendiente Baja (Costo Var.)</div>
                    </div>
                </div>
            );
        };

        // --- COMPONENTE: ASISTENTE DE DECISIÓN ---
        const DecisionWizard = () => {
            const [answers, setAnswers] = useState({});
            
            const questions = [
                { id: 'length', text: 'Longitud del Túnel', opts: [{val: 1, label: '< 3 km'}, {val: 2, label: '3 - 6 km'}, {val: 3, label: '> 6 km'}] },
                { id: 'geo', text: 'Calidad del Macizo Rocoso', opts: [{val: 1, label: 'Muy Mala / Fallas'}, {val: 2, label: 'Variable'}, {val: 3, label: 'Homogénea / Buena'}] },
                { id: 'section', text: 'Forma de la Sección', opts: [{val: 1, label: 'Variable / Herradura'}, {val: 3, label: 'Circular Estricta'}] },
                { id: 'time', text: 'Inicio de Excavación', opts: [{val: 1, label: 'Urgente (Inmediato)'}, {val: 3, label: 'Planificado (> 6 meses)'}] }
            ];

            const calculateScore = () => {
                let tbmScore = 0;
                let pyvScore = 0;
                
                // Lógica simple de pesos
                if(answers.length === 1) pyvScore += 3;
                if(answers.length === 3) tbmScore += 3;
                
                if(answers.geo === 1) pyvScore += 2; // TBM se atasca en fallas
                if(answers.geo === 3) tbmScore += 2;

                if(answers.section === 1) pyvScore += 3;
                if(answers.section === 3) tbmScore += 2;

                if(answers.time === 1) pyvScore += 3; // TBM tarda en llegar
                if(answers.time === 3) tbmScore += 1;

                return { tbmScore, pyvScore };
            };

            const { tbmScore, pyvScore } = calculateScore();
            const total = tbmScore + pyvScore || 1;
            const tbmPercent = Math.round((tbmScore / total) * 100);

            return (
                <div className="grid lg:grid-cols-2 gap-8 slide-in">
                    <div className="space-y-6">
                        {questions.map(q => (
                            <div key={q.id} className="bg-white p-4 rounded-lg shadow-sm border border-slate-100">
                                <h4 className="font-semibold text-slate-700 mb-3">{q.text}</h4>
                                <div className="flex flex-wrap gap-2">
                                    {q.opts.map(opt => (
                                        <button 
                                            key={opt.val}
                                            onClick={() => setAnswers({...answers, [q.id]: opt.val})}
                                            className={`px-3 py-1.5 text-sm rounded-full transition-colors border ${answers[q.id] === opt.val ? 'bg-indigo-600 text-white border-indigo-600' : 'bg-slate-50 text-slate-600 border-slate-200 hover:border-indigo-300'}`}
                                        >
                                            {opt.label}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>
                    <div className="bg-slate-900 text-white p-8 rounded-xl flex flex-col justify-center items-center text-center shadow-xl">
                        <div className="mb-4">
                            <Icon path={icons.brain} className="w-12 h-12 text-indigo-400" />
                        </div>
                        <h3 className="text-2xl font-bold mb-2">Recomendación del Sistema</h3>
                        
                        {Object.keys(answers).length < questions.length ? (
                            <p className="text-slate-400">Responde todas las preguntas para obtener el análisis.</p>
                        ) : (
                            <div className="w-full animate-pulse-once">
                                <div className="text-4xl font-extrabold mb-1 bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-cyan-300">
                                    {tbmScore > pyvScore ? 'TUNELADORA (TBM)' : 'PERFORACIÓN Y VOLADURA'}
                                </div>
                                <p className="text-slate-300 mb-6 text-sm">Basado en tus parámetros técnicos</p>
                                
                                <div className="w-full bg-slate-700 h-4 rounded-full overflow-hidden flex mb-2">
                                    <div style={{width: `${tbmPercent}%`}} className="bg-blue-500 h-full transition-all duration-1000"></div>
                                    <div style={{width: `${100-tbmPercent}%`}} className="bg-orange-500 h-full transition-all duration-1000"></div>
                                </div>
                                <div className="flex justify-between text-xs font-bold text-slate-400">
                                    <span className="text-blue-400">TBM ({tbmPercent}%)</span>
                                    <span className="text-orange-400">PyV ({100-tbmPercent}%)</span>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- COMPONENTE: VISUALIZACIÓN DE DRENAJE ---
        const DrainageVisualizer = () => {
            const [method, setMethod] = useState('dren'); // 'dren' | 'pozo'

            return (
                <div className="bg-white rounded-xl shadow border border-slate-200 overflow-hidden slide-in">
                    <div className="flex border-b">
                        <button 
                            onClick={() => setMethod('dren')} 
                            className={`flex-1 p-4 text-center font-medium ${method === 'dren' ? 'bg-blue-50 text-blue-700 border-b-2 border-blue-600' : 'text-slate-500 hover:bg-slate-50'}`}
                        >
                            Drenes Horizontales
                        </button>
                        <button 
                            onClick={() => setMethod('pozo')} 
                            className={`flex-1 p-4 text-center font-medium ${method === 'pozo' ? 'bg-blue-50 text-blue-700 border-b-2 border-blue-600' : 'text-slate-500 hover:bg-slate-50'}`}
                        >
                            Pozos de Abatimiento
                        </button>
                    </div>
                    
                    <div className="grid md:grid-cols-2 p-6 gap-8 items-center">
                        <div className="h-64 bg-slate-100 rounded-lg relative overflow-hidden border border-slate-300">
                            {/* Visualización Esquemática SVG */}
                            <svg className="w-full h-full" viewBox="0 0 400 300">
                                {/* Terreno */}
                                <rect width="400" height="300" fill="#e2e8f0" />
                                {/* Nivel Freático Original */}
                                <path d="M0 50 Q 200 50 400 50" stroke="#3b82f6" strokeWidth="2" strokeDasharray="5,5" fill="none"/>
                                <text x="10" y="45" fontSize="12" fill="#3b82f6">Nivel Freático</text>
                                
                                {/* Túnel */}
                                <circle cx="200" cy="200" r="40" fill="#1e293b" />
                                
                                {method === 'dren' ? (
                                    <React.Fragment>
                                        {/* Drenes Radiando desde el túnel */}
                                        <line x1="200" y1="200" x2="100" y2="150" stroke="#f59e0b" strokeWidth="3" />
                                        <line x1="200" y1="200" x2="300" y2="150" stroke="#f59e0b" strokeWidth="3" />
                                        <line x1="200" y1="200" x2="200" y2="100" stroke="#f59e0b" strokeWidth="3" />
                                        {/* Cono de depresión local */}
                                        <path d="M0 50 Q 200 180 400 50" stroke="#3b82f6" strokeWidth="2" fill="rgba(59, 130, 246, 0.1)"/>
                                    </React.Fragment>
                                ) : (
                                    <React.Fragment>
                                        {/* Pozo Vertical desde superficie */}
                                        <rect x="250" y="0" width="10" height="220" fill="#64748b" />
                                        <rect x="245" y="0" width="20" height="20" fill="#334155" />
                                        {/* Cono de depresión general */}
                                        <path d="M0 50 Q 255 220 400 50" stroke="#3b82f6" strokeWidth="2" fill="rgba(59, 130, 246, 0.1)"/>
                                    </React.Fragment>
                                )}
                            </svg>
                        </div>
                        <div>
                            <h3 className="text-xl font-bold text-slate-800 mb-2">
                                {method === 'dren' ? 'Drenaje Pasivo (Desde el interior)' : 'Drenaje Activo (Desde superficie)'}
                            </h3>
                            <p className="text-slate-600 mb-4 text-sm leading-relaxed">
                                {method === 'dren' 
                                    ? "Se perforan barrenos largos desde el interior del túnel hacia el macizo rocoso. Alivian la presión hidrostática localmente justo antes de excavar o para proteger el revestimiento."
                                    : "Implica perforar pozos profundos desde la superficie equipados con bombas sumergibles. Su objetivo es bajar el nivel freático general de la zona ANTES de que llegue el túnel."
                                }
                            </p>
                            <div className="bg-yellow-50 p-3 rounded border border-yellow-200 text-sm text-yellow-800 flex gap-2">
                                <Icon path={icons.alert} className="w-5 h-5 shrink-0" />
                                <p><strong>Cuándo usar:</strong> {method === 'dren' ? 'Roca competente, filtraciones localizadas.' : 'Suelos permeables, acuíferos grandes, excavación superficial.'}</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('sim'); // sim, wiz, drain

            // Estados para el simulador
            const [simParams, setSimParams] = useState({
                len: 6,
                fixPyV: 2, varPyV: 5, // Millions, k/m
                fixTBM: 15, varTBM: 2.5
            });

            // Cálculos dinámicos
            const costPyV = simParams.fixPyV + (simParams.len * simParams.varPyV);
            const costTBM = simParams.fixTBM + (simParams.len * simParams.varTBM);
            const diff = Math.abs(costTBM - costPyV).toFixed(1);
            const winner = costTBM < costPyV ? 'TBM' : 'PyV';

            return (
                <div className="min-h-screen pb-20">
                    {/* Header */}
                    <div className="bg-slate-900 text-white pt-10 pb-20 px-4">
                        <div className="max-w-5xl mx-auto text-center">
                            <h1 className="text-3xl md:text-4xl font-extrabold mb-4 tracking-tight">Evaluación y Optimización de Túneles</h1>
                            <p className="text-slate-400 text-lg">Herramienta técnica de soporte a la decisión para ingeniería de minas</p>
                        </div>
                    </div>

                    {/* Main Container */}
                    <div className="max-w-5xl mx-auto px-4 -mt-12">
                        
                        {/* Navigation Cards */}
                        <div className="grid grid-cols-3 gap-2 md:gap-4 mb-8">
                            {[
                                {id: 'sim', label: 'Simulador Económico', icon: icons.chart},
                                {id: 'wiz', label: 'Asistente de Decisión', icon: icons.brain},
                                {id: 'drain', label: 'Gestión Hidrogeológica', icon: icons.droplet}
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex flex-col items-center justify-center p-4 md:p-6 rounded-xl shadow-lg transition-all transform hover:-translate-y-1 ${activeTab === tab.id ? 'bg-white text-indigo-600 ring-2 ring-indigo-500' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}
                                >
                                    <Icon path={tab.icon} className="w-6 h-6 md:w-8 md:h-8 mb-2" />
                                    <span className="font-bold text-xs md:text-sm">{tab.label}</span>
                                </button>
                            ))}
                        </div>

                        {/* Content Area */}
                        <div className="space-y-6">
                            
                            {/* TAB: SIMULADOR */}
                            {activeTab === 'sim' && (
                                <div className="slide-in">
                                    <div className="grid lg:grid-cols-3 gap-6">
                                        {/* Controls */}
                                        <div className="lg:col-span-1 bg-white p-6 rounded-xl shadow border border-slate-200 space-y-6">
                                            <div>
                                                <label className="text-xs font-bold text-slate-500 uppercase">Longitud del Túnel</label>
                                                <div className="flex items-center gap-2 mb-2">
                                                    <span className="text-2xl font-bold text-slate-800">{simParams.len} km</span>
                                                </div>
                                                <input 
                                                    type="range" min="1" max="15" step="0.5" 
                                                    value={simParams.len}
                                                    onChange={(e) => setSimParams({...simParams, len: parseFloat(e.target.value)})}
                                                    className="w-full"
                                                />
                                            </div>
                                            
                                            <div className="pt-4 border-t border-slate-100">
                                                <div className="flex items-center gap-2 mb-3">
                                                    <div className="w-3 h-3 rounded-full bg-orange-500"></div>
                                                    <h4 className="font-bold text-slate-700">Parámetros PyV</h4>
                                                </div>
                                                <div className="space-y-3">
                                                    <div>
                                                        <label className="flex justify-between text-xs text-slate-500">
                                                            <span>Costo Fijo (Inversión)</span>
                                                            <span>${simParams.fixPyV}M</span>
                                                        </label>
                                                        <input type="range" min="0.5" max="5" step="0.5" value={simParams.fixPyV} onChange={(e) => setSimParams({...simParams, fixPyV: parseFloat(e.target.value)})} className="w-full accent-orange-500"/>
                                                    </div>
                                                    <div>
                                                        <label className="flex justify-between text-xs text-slate-500">
                                                            <span>Costo Variable ($k/m)</span>
                                                            <span>${simParams.varPyV}k</span>
                                                        </label>
                                                        <input type="range" min="2" max="10" step="0.5" value={simParams.varPyV} onChange={(e) => setSimParams({...simParams, varPyV: parseFloat(e.target.value)})} className="w-full accent-orange-500"/>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className="pt-4 border-t border-slate-100">
                                                <div className="flex items-center gap-2 mb-3">
                                                    <div className="w-3 h-3 rounded-full bg-blue-500"></div>
                                                    <h4 className="font-bold text-slate-700">Parámetros TBM</h4>
                                                </div>
                                                <div className="space-y-3">
                                                    <div>
                                                        <label className="flex justify-between text-xs text-slate-500">
                                                            <span>Costo Fijo (Inversión)</span>
                                                            <span>${simParams.fixTBM}M</span>
                                                        </label>
                                                        <input type="range" min="5" max="30" step="1" value={simParams.fixTBM} onChange={(e) => setSimParams({...simParams, fixTBM: parseFloat(e.target.value)})} className="w-full accent-blue-500"/>
                                                    </div>
                                                    <div>
                                                        <label className="flex justify-between text-xs text-slate-500">
                                                            <span>Costo Variable ($k/m)</span>
                                                            <span>${simParams.varTBM}k</span>
                                                        </label>
                                                        <input type="range" min="1" max="5" step="0.5" value={simParams.varTBM} onChange={(e) => setSimParams({...simParams, varTBM: parseFloat(e.target.value)})} className="w-full accent-blue-500"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Visualization */}
                                        <div className="lg:col-span-2 space-y-6">
                                            <CostChart 
                                                length={simParams.len} 
                                                fixedPyV={simParams.fixPyV} varPyV={simParams.varPyV}
                                                fixedTBM={simParams.fixTBM} varTBM={simParams.varTBM}
                                            />
                                            
                                            <div className={`p-6 rounded-xl text-white shadow-lg flex items-center justify-between ${winner === 'TBM' ? 'bg-blue-600' : 'bg-orange-600'}`}>
                                                <div>
                                                    <p className="opacity-80 text-sm font-medium uppercase tracking-wider">Opción más rentable</p>
                                                    <h2 className="text-3xl font-bold">{winner === 'TBM' ? 'Tuneladora (TBM)' : 'Perforación y Voladura'}</h2>
                                                    <p className="mt-1 text-sm opacity-90">
                                                        Ahorro estimado de <strong>${diff} Millones</strong> para {simParams.len} km.
                                                    </p>
                                                </div>
                                                <div className="bg-white/20 p-3 rounded-full">
                                                    <Icon path={icons.check} className="w-8 h-8" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* TAB: WIZARD */}
                            {activeTab === 'wiz' && (
                                <DecisionWizard />
                            )}

                            {/* TAB: DRENAJE */}
                            {activeTab === 'drain' && (
                                <DrainageVisualizer />
                            )}

                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
